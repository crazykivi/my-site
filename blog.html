<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление записями</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Quill.js CSS -->
    <link href="https://cdn.jsdelivr.net/npm/quill/dist/quill.snow.css" rel="stylesheet">
    <style>
        .ql-editor {
            min-height: 200px;
        }

        .page-button {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <header class="bg-dark text-white py-3">
        <div class="container d-flex justify-content-between">
            <h1 class="h4">Управление записями</h1>
            <nav>
                <a href="index.html" class="text-white text-decoration-none mx-2">Главная</a>
            </nav>
        </div>
    </header>

    <main class="container my-5">
        <div id="records-container">
            <h2>Записи</h2>
            <div id="records-list" class="mb-3">
            </div>
            <nav aria-label="Pagination">
                <ul id="pagination" class="pagination">
                </ul>
            </nav>
        </div>

        <div id="add-record-panel" class="d-none mt-5">
            <h2>Добавить новую запись</h2>
            <div id="editor" class="mb-3"></div>
            <button id="save-button" class="btn btn-success">Сохранить запись</button>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Quill.js -->
    <script src="https://cdn.jsdelivr.net/npm/quill/dist/quill.min.js"></script>
    <script>
        // Инициализация Quill.js
        const editor = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline', 'strike'],
                    ['link', 'image'],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    [{ 'align': [] }],
                    ['blockquote', 'code-block'],
                    [{ 'header': '1' }, { 'header': '2' }],
                    [{ 'font': [] }],
                    [{ 'size': ['small', 'medium', 'large'] }],
                    [{ 'color': [] }, { 'background': [] }],
                ]
            }
        });

        /*
        const hasAccess = document.cookie.includes('auth_token=');
        if (hasAccess) {
            document.getElementById('add-record-panel').style.display = 'block';
        }
            */

        document.getElementById('save-button').addEventListener('click', () => {
            const newRecord = { content: editor.root.innerHTML };

            fetch('/save-record', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newRecord)
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Запись сохранена:', data);
                    editor.root.innerHTML = '';
                })
                .catch(error => console.error('Ошибка при сохранении записи:', error));
        });

        function loadRecords() {
            fetch('/get-records')
                .then(response => response.json())
                .then(data => {
                    renderRecords(data);
                    renderPagination(data.length);
                })
                .catch(error => console.error('Ошибка загрузки данных:', error));
        }

        function renderRecords(records) {
            const recordsList = document.getElementById('records-list');
            recordsList.innerHTML = '';
            records.forEach(record => {
                const recordElement = document.createElement('div');
                recordElement.className = 'card mb-3';
                recordElement.innerHTML = `
                    <div class="card-body">
                        <div class="ql-editor">${record.content}</div>
                    </div>
                `;
                recordsList.appendChild(recordElement);
            });
        }

        function renderPagination(totalRecords) {
            const recordsPerPage = 5;
            const totalPages = Math.ceil(totalRecords / recordsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement('li');
                pageItem.className = `page-item`;
                pageItem.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                pagination.appendChild(pageItem);
            }

            document.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = parseInt(e.target.dataset.page);
                    console.log(`Переключаем на страницу ${page}`);
                });
            });
        }

        loadRecords();
    </script>
</body>

</html>